<!DOCTYPE html>
<html lang="en-AU">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Vine</title>

  <link rel="icon" type="image/png" sizes="32x32" href="/static/img/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/static/img/favicon/favicon-16x16.png">
  <link rel="manifest" href="/static/manifest.json">

  <!-- Additional PWA meta tags -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Vine">
  <meta name="theme-color" content="#000000">
  <meta name="msapplication-TileColor" content="#000000">

  <!-- Apple touch icons -->
  <link rel="apple-touch-icon" href="/static/icons/icon-192x192.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/static/icons/icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/static/icons/icon-192x192.png">

  <link rel="stylesheet" href="/static/css/site.css" />
  <link rel="stylesheet" href="/static/css/nav.css" />
  <link rel="stylesheet" href="/static/external/css/bulma/css/bulma.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@1.0.4/css/bulma.min.css">
  <script src="/static/external/js/htmx/htmx.min.js"></script>
  <script src="/static/external/js/htmx/debug.js"></script>
  <link rel="stylesheet" href="/static/external/css/font_awesome/fontawesome-free-7.0.0-web/css/all.min.css" />

  <div metal:define-slot="additional-css" tal:omit-tag="True"></div>
</head>

<body hx-ext="debug">

  <nav class="navbar is-fixed-top" role="navigation" aria-label="main navigation">
    <div class="navbar-brand">
      <a tal:condition="is_logged_in" class="navbar-item">
        <img src="/static/img/logo.png" style="height: 28px;" />
      </a>

      <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="navbarBasicExample">
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
      </a>
    </div>

    <div id="navbarBasicExample" class="navbar-menu">
      <div class="navbar-start">
        <a tal:condition="is_logged_in" href="/vineyards" class="navbar-item"> Vineyards </a>
        <a tal:condition="is_admin" href="/spray_programs" class="navbar-item"> Spray Programs </a>
      </div>


      <div class="navbar-end">
        <!-- Mobile-friendly user info -->
        <div tal:condition="is_logged_in" class="navbar-item is-hidden-desktop">
          <div class="is-flex is-flex-direction-column">
            <span class="is-size-7">${user.name}</span>
            <span class="tag is-info is-small">${user.role.value}</span>
          </div>
        </div>

        <!-- Desktop user info -->
        <div tal:condition="is_logged_in" class="navbar-item is-hidden-touch">
          <span>Welcome, ${user.name}</span>
          <span class="tag is-info ml-2">${user.role.value}</span>
        </div>

        <div class="navbar-item">
          <div class="buttons are-small">
            <div tal:condition="not is_logged_in">
              <a href="/account/login/" class="button is-light"> Log in </a>
            </div>

            <div tal:condition="is_logged_in">
              <a href="/account/" class="button is-primary">
                <strong>Account</strong>
              </a>
            </div>

            <div tal:condition="is_admin">
              <a class="button is-warning" href="/administration/dashboard">
                Admin
              </a>
            </div>

            <div tal:condition="is_logged_in">
              <a href="/account/logout/" class="button is-light"> Log out </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </nav>

  <!-- Add padding to account for fixed navbar -->
  <div class="navbar-spacer" style="height: 52px;"></div>

  <div class="columns is-gapless is-multiline">
    <!-- Optional Left Spacer (hide on mobile/tablet) -->
    <div class="column is-hidden-touch is-1-desktop is-2-widescreen"></div>

    <!-- Main Content Column -->
    <div class="column is-12-mobile is-12-tablet is-10-desktop is-8-widescreen">
      <div class="container main_content px-4 py-5">
        <!-- Message Area -->
        <div id="message-area">
          <!-- Messages will be injected here -->
        </div>

        <!-- Notification Messages -->
        <div tal:condition="success" class="notification is-success is-light">
          <button class="delete" hx-get="/empty" hx-target="closest .notification" hx-swap="outerHTML"></button>
          <span tal:content="structure success"></span>
        </div>

        <div tal:condition="error" class="notification is-danger is-light">
          <button class="delete" hx-get="/empty" hx-target="closest .notification" hx-swap="outerHTML"></button>
          <span tal:content="structure error"></span>
        </div>

        <div tal:condition="warning" class="notification is-warning is-light">
          <button class="delete" hx-get="/empty" hx-target="closest .notification" hx-swap="outerHTML"></button>
          <span tal:content="structure warning"></span>
        </div>

        <div tal:condition="info" class="notification is-info is-light">
          <button class="delete" hx-get="/empty" hx-target="closest .notification" hx-swap="outerHTML"></button>
          <span tal:content="structure info"></span>
        </div>

        <!-- Logo for non-logged in users -->
        <div tal:condition="not is_logged_in" class="section has-text-centered">
          <figure class="image is-inline-block">
            <img src="/static/img/logo.png" style="max-width: min(300px, 80vw); width: 100%;" alt="Logo">
          </figure>
        </div>

        <!-- Main Content Slot -->
        <div tal:condition="is_logged_in" metal:define-slot="content" tal:omit-tag="True">No content</div>
      </div>
    </div>

    <!-- Optional Right Spacer (hide on mobile/tablet) -->
    <div class="column is-hidden-touch is-1-desktop is-2-widescreen"></div>
  </div>

  <footer tal:condition="is_logged_in" class="footer mt-6">
    <div class="content has-text-centered copyright">
      <p class="is-size-7-mobile">
        <strong>Copyright &copy;
          <a href="http://www.ahaviticulture.com.au/">AHA Viticulture</a></strong>
      </p>
    </div>
  </footer>

  <div metal:define-slot="additional-js" tal:omit-tag="True"></div>

  <!-- Service Worker Registration -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/static/js/service_worker.js')
          .then(registration => {
            console.log('SW registered for PWA install capability');
          })
          .catch(registrationError => {
            console.log('SW registration failed:', registrationError);
          });
      });
    }
  </script>

  <!-- Mobile navbar toggle script -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Get all "navbar-burger" elements
      const $navbarBurgers = Array.prototype.slice.call(document.querySelectorAll('.navbar-burger'), 0);

      // Add a click event on each of them
      $navbarBurgers.forEach(el => {
        el.addEventListener('click', () => {
          // Get the target from the "data-target" attribute
          const target = el.dataset.target;
          const $target = document.getElementById(target);

          // Toggle the "is-active" class on both the "navbar-burger" and the "navbar-menu"
          el.classList.toggle('is-active');
          $target.classList.toggle('is-active');
        });
      });
    });
  </script>

</body>

</html>