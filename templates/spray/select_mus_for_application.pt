<div metal:use-macro="load: ../shared/_layout.pt">
    <div metal:fill-slot="content" tal:omit-tag="True">
        <div class="section content">
            <div class="container vineyard-list">
                <div class="vineyard-list container">
                    <h2 class="title">Select Management Units for ${spray.name} Application</h2>
                    <div class="content">
                    </div>
                    <div id="message-area"></div>
                    <form method="post" action="/sprays/${spray.id}/apply_to_select_units">
                        <div class="field">

                            <div tal:repeat="vineyard vineyards" class="control">
                                <div class="box" id="${vineyard.name_slugified}-block">
                                    <label class="label">
                                        <h3>${vineyard.name}</h3>
                                    </label>
                                    <div class="buttons">
                                        <button class="button is-primary is-small is-outlined"
                                            hx-get="/sprays/${vineyard.id}/select_all"
                                            hx-target="#${vineyard.name_slugified}-block" hx-swap="outerHTML">
                                            Select all ${vineyard.name} Units
                                        </button>
                                    </div>
                                    <tal:block tal:repeat="management_unit vineyard.management_units">
                                        <label tal:condition="management_unit.is_active" class="checkbox is-block mb-2">
                                            <input type="checkbox" name="management_unit_ids"
                                                value="${management_unit.id}" />

                                            ${management_unit.name_with_variety}
                                            <span tal:condition="management_unit.variety_name_modifier and not 'null' in
                                            management_unit.variety_name_modifier.lower().strip()">
                                                (${management_unit.variety_name_modifier})</span>
                                            <span tal:condition="not management_unit.variety">-
                                                ${management_unit.status}</span>
                                        </label>
                                        <label tal:condition="not management_unit.is_active"
                                            class="checkbox is-block mb-2">
                                            &nbsp;&nbsp;&nbsp;&nbsp;

                                            ${management_unit.name_with_variety}
                                            <span tal:condition="management_unit.variety_name_modifier and not 'null' in
                                            management_unit.variety_name_modifier.lower().strip()">
                                                (${management_unit.variety_name_modifier})</span>
                                            <span tal:condition="not management_unit.variety">-
                                                ${management_unit.status}</span>
                                        </label>
                                    </tal:block>
                                    <div class="field is-grouped">
                                        <div class="control">
                                            <button type="submit" class="button is-primary is-small">Apply to
                                                Selected</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div metal:fill-slot="additional-css" tal:omit-tag="True">
        <!-- additional css from the page -->
    </div>
</div>